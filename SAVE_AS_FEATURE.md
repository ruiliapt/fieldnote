# 数据库"另存为"功能说明

**添加日期**: 2025-10-20  
**版本**: 0.1.1  
**功能**: 数据库另存为

---

## 🆕 新功能

### 数据库另存为

在"文件"菜单中新增"另存为..."选项，快捷键 `Ctrl+Shift+S`（Windows/Linux）或 `Cmd+Shift+S`（macOS）。

---

## 🎯 功能特点

### 智能建议
- 自动建议文件名（原文件名 + "_副本"）
- 默认保存在当前数据库同目录
- 自动添加 `.db` 扩展名

### 安全保护
- 覆盖前确认提示
- 检查文件是否已存在
- 复制完整的数据库文件

### 灵活切换
- 保存后可选择切换到新数据库
- 也可以继续使用原数据库
- 两个选项都很清晰

---

## 📖 使用方法

### 基础用法

1. **打开程序**
   - 启动 Fieldnote Lite
   - 确保有数据库打开

2. **执行另存为**
   - 点击菜单：文件 → 另存为...
   - 或按快捷键：`Ctrl+Shift+S`

3. **选择位置**
   - 选择保存位置
   - 修改文件名（可选）
   - 点击"保存"

4. **选择是否切换**
   - "是" - 切换到新数据库继续工作
   - "否" - 保留原数据库继续工作

---

## 💡 应用场景

### 1. 快速备份

创建当前数据库的备份：

```
步骤：
1. 文件 → 另存为
2. 文件名：corpus_backup_2025-10-20.db
3. 保存后选择"否"（继续使用原数据库）

结果：
- 原数据库：~/.fieldnote/corpus.db（继续使用）
- 备份文件：~/Backup/corpus_backup_2025-10-20.db
```

### 2. 创建实验副本

在不影响原数据的情况下测试新想法：

```
步骤：
1. 文件 → 另存为
2. 文件名：corpus_实验版.db
3. 保存后选择"是"（切换到新数据库）

结果：
- 原数据库：保持不变
- 实验数据库：corpus_实验版.db（当前工作）
```

### 3. 分阶段保存

项目不同阶段保存快照：

```
项目目录：
~/语言调查项目/
├── corpus_初稿.db        （第一版）
├── corpus_审校后.db      （第二版）
└── corpus_最终版.db      （当前工作）

方法：
每个阶段完成后：文件 → 另存为 → 保存快照
```

### 4. 分发给同事

创建副本分享给团队成员：

```
步骤：
1. 文件 → 另存为
2. 保存到：~/Dropbox/共享数据库.db
3. 选择"否"（继续使用自己的数据库）

结果：
- 自己的数据库继续工作
- 共享副本供同事查看
```

---

## 🛡️ 安全特性

### 覆盖保护
```
如果目标文件已存在：
  ╔════════════════════════════════╗
  ║        确认覆盖               ║
  ║                                ║
  ║  文件已存在：                  ║
  ║  /path/to/corpus.db            ║
  ║                                ║
  ║  是否覆盖？                    ║
  ║                                ║
  ║     [是]      [否]             ║
  ╚════════════════════════════════╝
```

### 切换确认
```
另存为成功后：
  ╔════════════════════════════════╗
  ║      另存为成功               ║
  ║                                ║
  ║  数据库已保存到：              ║
  ║  /path/to/new_corpus.db        ║
  ║                                ║
  ║  是否切换到新数据库？          ║
  ║  (选择"否"将继续使用当前数据库) ║
  ║                                ║
  ║     [是]      [否]             ║
  ╚════════════════════════════════╝
```

---

## 🔄 与其他功能的对比

| 功能 | 用途 | 结果 |
|------|------|------|
| **新建数据库** | 创建空数据库 | 新的空数据库 |
| **打开数据库** | 切换到其他数据库 | 打开现有数据库 |
| **另存为** ⭐ | 复制当前数据库 | 数据库副本 |

---

## ⌨️ 快捷键

| 平台 | 快捷键 |
|------|--------|
| Windows | `Ctrl+Shift+S` |
| Linux | `Ctrl+Shift+S` |
| macOS | `Cmd+Shift+S` |

---

## 🔍 技术细节

### 实现方式
- 使用 Python `shutil.copy2()` 复制文件
- 保留原文件的元数据（时间戳等）
- 复制前检查目标路径有效性

### 文件完整性
- 完整复制 SQLite 数据库文件
- 包含所有表和索引
- 保持数据完整性

### 错误处理
- 捕获并显示复制错误
- 磁盘空间不足提示
- 权限问题提示

---

## ❓ 常见问题

### Q: 另存为会影响原数据库吗？
**A**: 不会。另存为是复制操作，不会修改原数据库。

### Q: 可以另存为到其他格式吗？
**A**: 暂不支持。仅支持 `.db` 格式（SQLite）。

### Q: 另存为后两个数据库是独立的吗？
**A**: 是的。修改一个不会影响另一个。

### Q: 可以取消另存为操作吗？
**A**: 可以。在文件选择对话框点击"取消"即可。

### Q: 另存为大文件会很慢吗？
**A**: 取决于文件大小。1MB 的数据库通常在 1 秒内完成。

### Q: 能在另存为时自动压缩吗？
**A**: 当前版本不支持。建议使用外部工具压缩。

---

## 📝 更新日志

### v0.1.1 (2025-10-20)
- ✅ 新增"另存为"功能
- ✅ 智能文件名建议
- ✅ 覆盖保护
- ✅ 灵活的切换选项
- ✅ 快捷键支持

---

## 🚀 未来计划

可能的增强功能：
- [ ] 导出为其他格式（CSV、JSON、Excel）
- [ ] 压缩归档功能
- [ ] 自动定时备份
- [ ] 版本历史管理
- [ ] 差异对比功能

---

## 💡 最佳实践

### 备份策略
```
推荐的备份命名：
- corpus_2025-10-20.db         （日期备份）
- corpus_v1.0.db                （版本备份）
- corpus_before_import.db       （操作前备份）
- corpus_milestone_1.db         （里程碑备份）
```

### 工作流程
```
1. 开始重要操作前 → 另存为备份
2. 每天/每周 → 另存为日期备份
3. 重要版本完成 → 另存为版本备份
4. 分享给他人 → 另存为共享副本
```

---

**功能文档** - Fieldnote Lite v0.1.1

